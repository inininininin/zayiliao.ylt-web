<!DOCTYPE html>
<html>
<script>
    var token,queryString,currentPath;
</script>
<head>
    <title>个人中心</title>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <script src="../../libs/jquery.min.js"></script>
    <script src="../../libs/jquery.cookie.js"></script>
    <script src="../../libs/rxw/rxw.js"></script>
    <script src="../../libs/giveup2.js"></script>
    <script src="../../libs/jquery.growl/javascripts/jquery.growl.js" type="text/javascript"></script>
    <link href="../../libs/jquery.growl/stylesheets/jquery.growl.css" rel="stylesheet" type="text/css" />
    <script>
        queryString = rxw1.parseQueryStr(location.search.substr(1));
        currentPath=queryString.currentPath;
        token = $.cookie('login-token');

    </script>
    <script src="../../libs/upload.js"></script>
    <script src="../../libs/cropper/cropper.js"></script>
    <link href="../../libs/cropper/cropper.css" rel="stylesheet" />
    <style>

        .title {
            font-weight: 600;
        }
    </style>
</head>

<body style="margin:0;">
<div id="currentPath"  style="margin:5px 0 0 5px;font-size: 14px"></div>
<hr/>
<div style="width:100%;">
    <div id="detailPad" style="line-height: 20px;text-align: center">
        <fieldset>
            <legend style="color: #595959">详细信息</legend>
            <div style="margin:15px 0;">
                <div class="title">用户名</div>
                <div id="username"></div>
            </div>
            <div style="margin:15px 0;">
                <div class="title">手机</div>
                <div id="phone"></div>
            </div>
            <div style="margin:15px 0;">
                <div class="title">姓名</div>
                <div id="realname"></div>
            </div>
            <div style="margin:15px 0;">
                <div class="title">角色</div>
                <div id="role"></div>
            </div>
            <div style="margin:15px 0;">
                <div class="title">email</div>
                <div id="email"></div>
            </div>
            <div style="margin:15px 0;">
                <div class="title">注册时间</div>
                <div id="registerTime"></div>
            </div>
        </fieldset>
    </div>



    <div style="margin-top:20px;text-align: center">
        <button id="alterPwdPageEnt" onclick="$('#alterPwdPage').show().trigger('clearPage');" style="margin:0 10px;margin-top:5px;width:100px;height:30px">修改密码</button>
    </div>
    <div style="margin-top:20px;"></div>
</div>



<div id="alterPwdPage" style="padding-top:100px;top:0;left:0;bottom:0;right:0;overflow:auto;z-index:999999999;display: none;position:fixed;background-color: rgba(0, 0, 0, 0.3)">
    <div style="width:30%;background-color: white;text-align:center;margin:auto;padding:15px 0;">
        <div >
            <div class="title">原始密码</div>
            <div><input type="password" name="oldPwd"></div>
        </div>
        <div >
            <div class="title">新密码</div>
            <div><input type="password" name="newPwd"></div>
        </div>
        <div >
            <div class="title">新密码确认</div>
            <div><input type="password" name="newPwdConfirm"></div>
        </div>
        <div style="margin-top: 15px">
            <button onclick="alterPwd()">确认</button><button onclick="$('#alterPwdPage').hide()" style="margin-left:15px;">取消</button>
        </div>
    </div>
</div>

</body>
<script>

    $('#currentPath').text('当前路径: '+currentPath)

    $('#username').text( $.cookie('login-username'))
    $('#realname').text( $.cookie('login-realname'))
    $('#email').text(giveup2.stringUtils.trimToEmpty($.cookie('login-email')))
    $('#phone').text( $.cookie('login-phone'))
    $('#registerTime').text(giveup2.dateUtils.formatToDateTime( $.cookie('login-registerTime')))
    $('#role').text(parseMaintainUserRole( $.cookie('login-role')))


    function alterPwd(){
        var oldPwd = $('#alterPwdPage [name=oldPwd]').val();
        var newPwd = $('#alterPwdPage [name=newPwd]').val();
        var newPwdConfirm = $('#alterPwdPage [name=newPwdConfirm]').val();
        if(!oldPwd)
        {
            $.growl.error({ title:'', message: '旧密码不能空' });
            return
        }
        if(!newPwd)
        {
            $.growl.error({ title:'', message: '新密码不能空' });
            return
        }
        if(!newPwdConfirm)
        {
            $.growl.error({ title:'', message: '新密码确认不能空' });
            return
        }
        if(newPwd == oldPwd) {
            $.growl.error({ title:'', message: '新密码请勿与旧密码相同' });
            return
        }
        if(newPwd != newPwdConfirm) {
            $.growl.error({ title:'', message: '两次新密码不一致' });
            return
        }
        $.ajax({
            url: "/zaylt/mm/useraction/setpwdbyold",
            type: 'post',
            async: false,
            data:{token:token,oldPwd:oldPwd,newPwd:newPwd} ,
            success: function (res) {
                if (res.code == 0) {
                    location.reload()
                } else {
                    $.growl.error({ title:'', message: res.codeMsg });
                }
            }
        })
    }


    $('#alterPwdPage').bind('clearPage',function(){
        $(this).find('[name=oldPwd]').val('')
        $(this).find('[name=newPwd]').val('')
        $(this).find('[name=newPwdConfirm]').val('')
    })

    function parseMaintainUserRole(value){
        if(value==1)
            return '超级管理员';
        else if(value==2)
            return '管理员';
        else
            return '未知';
    }


</script>

</html>